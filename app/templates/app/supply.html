{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Supply List</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
</head>
<body>
  {% include 'app/navbar.html' %}
  {% block content %}

  <h2>Supply List</h2>

  <!-- Add Supply Button -->
  <div class="add-property-container">
    <button id="openModalBtn" class="add-btn">+ Add Supply</button>
  </div>

  <div class="content">
    <table border="1">
      <thead>
        <tr>
          <th>No.</th>
          <th>Supply Name</th>
          <th>Quantity</th>
          <th>Date Received</th>
          <th>Barcode</th>
          <th>Category</th>
          <th>Status</th>
          <th>Available</th>
          <th>Last Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for supply in supplies %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ supply.supply_name }}</td>
          <td>{{ supply.quantity }}</td>
          <td>{{ supply.date_received }}</td>
          <td>{{ supply.barcode }}</td>
          <td>{{ supply.category }}</td>
          <td>{{ supply.get_status_display }}</td>
          <td>{{ supply.available_for_request|yesno:"Yes,No" }}</td>
          <td>{{ supply.last_updated }}</td>
          <td>
            <!-- Edit Button -->
              <div class="button-group">
              <button class="edit-btn" 
              data-id="{{ supply.id }}"
              data-name="{{ supply.supply_name }}"
              data-quantity="{{ supply.quantity }}"
              data-date="{{ supply.date_received|date:'Y-m-d' }}"
              data-barcode="{{ supply.barcode }}"
              data-category="{{ supply.category }}"
              data-status="{{ supply.status }}"
              data-available="{{ supply.available_for_request }}">
              Edit
            </button>

            <!-- Delete Button -->
            <form method="POST" action="{% url 'delete_supply' supply.id %}">
              {% csrf_token %}
              <button type="submit" class="del-btn" onclick="return confirm('Are you sure you want to delete this supply?');">
                Delete
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9">No supplies available.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Add Supply Modal -->
  <div id="addSupplyModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModalBtn">&times;</span>
      <h3>Add New Supply</h3>
      <form method="POST" action="{% url 'add_supply' %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="submit-btn">Submit</button>
      </form>
    </div>
  </div>

  <!-- Edit Supply Modal -->
  <div id="editSupplyModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeEditModalBtn">&times;</span>
      <h3>Edit Supply</h3>
      <form method="POST" action="{% url 'edit_supply' %}">
        {% csrf_token %}
        <input type="hidden" name="id" id="edit_id" />
        <label>Supply Name</label>
        <input type="text" name="supply_name" id="edit_name" required />

        <label>Quantity</label>
        <input type="number" name="quantity" id="edit_quantity" required />

        <label>Date Received</label>
        <input type="date" name="date_received" id="edit_date" required />

        <label>Barcode</label>
        <input type="text" name="barcode" id="edit_barcode" required />

        <label>Category</label>
        <input type="text" name="category" id="edit_category" required />

        <label>Status</label>
        <select name="status" id="edit_status" required>
          <option value="low_stock">Low Stock</option>
          <option value="out_of_stock">Out of Stock</option>
          <option value="available">Available</option>
        </select>

        <label>Available for Request</label>
        <select name="available_for_request" id="edit_available">
          <option value="True">Yes</option>
          <option value="False">No</option>
        </select>


        <button type="submit" class="submit-btn">Update</button>
      </form>
    </div>
  </div>

  <script src="{% static 'scripts/supplyModal.js' %}"></script>

  {% endblock %}
</body>
</html>