{% load static %}
{% load user_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reservations</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <style>
    /* Main container styles matching system theme */
    .reservations-container {
      padding: 20px;
      margin-left: 270px;
      background-color: #f5f6fa;
      min-height: 100vh;
    }
    
    .reservations-title {
      color: #152d64;
      margin-bottom: 30px;
      font-size: 32px;
      font-weight: 600;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    /* Reservation cards with system theme */
    .reservation {
      border: none;
      border-radius: 12px;
      margin: 20px 0;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      color: inherit;
      display: block;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
    }
    
    .reservation:hover {
      background: white;
      border-color: transparent;
      box-shadow: 0 8px 25px rgba(21, 45, 100, 0.15);
      transform: translateY(-3px);
    }
    
    .reservation:hover .reservation-header {
      background: linear-gradient(135deg, #f8fbff 0%, #e8f4fd 100%);
    }
    
    .reservation:hover .reservation-header h4 {
      color: #152d64;
    }
    
    .reservation:hover .expand-indicator {
      color: #152d64 !important;
      font-weight: 600;
    }
    
    .reservation:hover .expand-indicator i {
      transform: scale(1.1);
    }
    
    .reservation:active {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(21, 45, 100, 0.2);
    }
    
    .reservation-header {
      background: #f8f9fa;
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      border-radius: 12px 12px 0 0;
      position: relative;
      user-select: none;
      transition: all 0.3s ease;
    }
    
    .reservation-header:hover {
      background: linear-gradient(135deg, #f8fbff 0%, #e8f4fd 100%);
    }
    
    .reservation-header h4 {
      margin: 0 0 15px 0;
      display: flex;
      align-items: center;
      font-size: 18px;
      font-weight: 600;
      color: #152d64;
    }
    
    .reservation-header h4::after {
      content: 'Click to expand';
      font-size: 11px;
      font-weight: normal;
      color: #6c757d;
      margin-left: auto;
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(21, 45, 100, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .reservation:hover .reservation-header h4::after {
      opacity: 1;
    }
    
    .reservation-header p {
      margin: 8px 0;
      color: #495057;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .reservation-header p strong {
      color: #152d64;
      font-weight: 600;
    }
    
    /* Toggle Arrow and Interaction Styles */
    .toggle-arrow {
      margin-right: 12px;
      transition: transform 0.3s ease, color 0.3s ease;
      color: #152d64;
      font-size: 16px;
    }
    
    .toggle-arrow.expanded {
      transform: rotate(180deg);
      color: #28a745;
    }
    
    .reservation:hover .toggle-arrow {
      color: #152d64;
      transform: scale(1.1);
    }
    
    .reservation:hover .toggle-arrow.expanded {
      transform: rotate(180deg) scale(1.1);
      color: #28a745;
    }
    
    /* Detail link styling */
    .detail-link {
      color: #152d64;
      text-decoration: none;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      border: 1px solid #152d64;
      background: transparent;
    }
    
    .detail-link:hover {
      background: #152d64;
      color: white;
      text-decoration: none;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.3);
    }
    
    /* Reservation items section */
    .reservation-items {
      padding: 0;
      background: #fefefe;
    }
    
    .reservation-item {
      padding: 16px 20px;
      border-bottom: 1px solid #f1f3f4;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s ease;
    }
    
    .reservation-item:last-child {
      border-bottom: none;
      border-radius: 0 0 12px 12px;
    }
    
    .reservation-item:hover {
      background-color: #f8f9fa;
    }
    
    .item-info {
      flex: 1;
    }
    
    .item-info strong {
      color: #152d64;
      font-weight: 600;
      font-size: 15px;
    }
    
    .item-info small {
      color: #6c757d;
      font-style: italic;
    }
    
    .item-actions {
      display: flex;
      gap: 10px;
    }
    
    /* Status badges with system colors */
    .item-status {
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-approved, .status-badge.status-approved {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-rejected, .status-badge.status-rejected {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-expired, .status-badge.status-expired {
      background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
      color: #383d41;
      border: 1px solid #d6d8db;
    }
    
    .status-pending, .status-badge.status-pending {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .status-active, .status-badge.status-active {
      background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .status-completed, .status-badge.status-completed {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
      color: #2d3748;
      border: 1px solid #cbd5e0;
    }
    
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Search and Filter Controls */
    .search-filter-container {
      margin-bottom: 25px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
      position: relative;
      overflow: visible;
    }
    
    .search-filter-form {
      margin: 0;
    }
    
    .search-row {
      display: grid;
      grid-template-columns: 250px 200px 150px 150px auto;
      gap: 15px;
      align-items: center;
      position: relative;
      overflow: visible;
    }
    
    .search-input-group {
      position: relative;
      max-width: 250px;
      width: 100%;
      height: 42px; /* Fixed height for alignment */
    }
    
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
      font-size: 14px;
    }
    
    .search-input {
      width: 100%;
      height: 42px;
      padding: 0 12px 0 35px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: #f8f9fa;
      box-sizing: border-box;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #152d64;
      background: white;
      box-shadow: 0 0 0 3px rgba(21, 45, 100, 0.1);
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      height: 42px; /* Match search input height */
      justify-content: center;
      position: relative;
      overflow: visible;
    }
    
    .filter-select, .date-input {
      height: 42px;
      padding: 0 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      background: #f8f9fa;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    .filter-select:focus, .date-input:focus {
      outline: none;
      border-color: #152d64;
      background: white;
      box-shadow: 0 0 0 3px rgba(21, 45, 100, 0.1);
    }
    
    .filter-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      height: 42px; /* Match other elements */
    }
    
    .btn-filter {
      height: 42px;
      padding: 0 20px;
      background: #152d64;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .btn-filter:hover {
      background: #0d1f4a;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(21, 45, 100, 0.3);
    }
    
    .btn-clear {
      height: 42px;
      padding: 0 20px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .btn-clear:hover {
      background: #5a6268;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      color: white;
      text-decoration: none;
    }
    
    /* Responsive design for search controls */
    @media (max-width: 1200px) {
      .search-row {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
      }
      
      .filter-buttons {
        grid-column: span 3;
        justify-content: flex-start;
      }
    }
    
    @media (max-width: 1000px) {
      .search-row {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .search-input-group {
        grid-column: span 2;
      }
      
      .filter-buttons {
        grid-column: span 2;
      }
    }
    
    @media (max-width: 900px) {
      .search-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .search-input-group {
        grid-column: span 1;
        max-width: 100%;
      }
      
      .filter-group:nth-child(2) {
        grid-column: span 1;
      }
      
      .filter-group:nth-child(3) {
        grid-column: span 1;
      }
      
      .filter-group:nth-child(4) {
        grid-column: span 1;
      }
      
      .filter-buttons {
        grid-column: span 1;
        justify-content: stretch;
      }
    }
    
    @media (max-width: 768px) {
      .reservations-container {
        margin-left: 0;
        padding: 15px;
      }
      
      .search-filter-container {
        padding: 15px;
        margin-left: 0;
        margin-right: 0;
      }
      
      .search-row {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      
      .search-input-group,
      .filter-group {
        max-width: 100%;
        width: 100%;
      }
      
      .filter-buttons {
        flex-direction: row;
        justify-content: space-between;
      }
      
      .btn-filter, .btn-clear {
        flex: 1;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .search-filter-container {
        padding: 10px;
      }
      
      .search-row {
        gap: 10px;
      }
      
      .search-input, .filter-select, .date-input {
        font-size: 16px; /* Prevent zoom on mobile */
      }
      
      .search-input-group,
      .filter-group {
        height: auto;
      }
      
      .btn-filter, .btn-clear {
        height: auto;
        padding: 12px 16px;
        font-size: 14px;
      }
      
      .filter-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .btn-filter, .btn-clear {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* Filter tabs with system theme */
    .filter-tabs {
      margin-bottom: 30px;
      background: white;
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
      display: flex;
      gap: 4px;
      overflow-x: auto;
    }
    
    .tab-button {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #6c757d;
      transition: all 0.3s ease;
      white-space: nowrap;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 120px;
    }
    
    .tab-button:hover {
      color: #152d64;
      background: rgba(21, 45, 100, 0.05);
    }
    
    .tab-button.active {
      background: linear-gradient(135deg, #152d64 0%, #1e3a8a 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.3);
    }
    
    /* Responsive design for filter tabs */
    @media (max-width: 768px) {
      .filter-tabs {
        justify-content: flex-start;
        padding: 6px;
      }
      
      .tab-button {
        min-width: 100px;
        padding: 10px 16px;
        font-size: 13px;
      }
    }
    
    @media (max-width: 480px) {
      .filter-tabs {
        padding: 4px;
        gap: 2px;
      }
      
      .tab-button {
        min-width: 80px;
        padding: 8px 12px;
        font-size: 12px;
      }
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .tab-content h3 {
      color: #152d64;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e9ecef;
    }
    
    /* Empty state styling */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
      background: white;
      border-radius: 12px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
    }
    
    .empty-state i {
      font-size: 48px;
      margin-bottom: 20px;
      color: #dee2e6;
    }
    
    .empty-state p {
      font-size: 16px;
      margin: 0;
      font-style: italic;
    }
    
    /* Calendar View Styles */
    .calendar-navigation {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
    }
    
    .calendar-nav-btn, .calendar-today-btn {
      padding: 10px 15px;
      background: #152d64;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .calendar-nav-btn:hover, .calendar-today-btn:hover {
      background: #0d1f4a;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(21, 45, 100, 0.3);
    }
    
    .calendar-month-year {
      font-size: 24px;
      font-weight: 600;
      color: #152d64;
      min-width: 250px;
      text-align: center;
    }
    
    .calendar-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    
    .legend-color.status-pending {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      border-color: #ffeaa7;
    }
    
    .legend-color.status-approved {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border-color: #c3e6cb;
    }
    
    .legend-color.status-active {
      background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
      border-color: #bee5eb;
    }
    
    .legend-color.status-completed {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
      border-color: #cbd5e0;
    }
    
    .legend-color.status-rejected {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      border-color: #f5c6cb;
    }
    
    .legend-color.status-expired {
      background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
      border-color: #d6d8db;
    }
    
    .calendar-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
      overflow: hidden;
    }
    
    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background: #152d64;
      color: white;
    }
    
    .calendar-day-header {
      padding: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .calendar-body {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #f1f3f4;
    }
    
    .calendar-day {
      background: white;
      min-height: 120px;
      padding: 8px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 4px;
    }
    
    .calendar-day:hover {
      background: #f8f9fa;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
    }
    
    .calendar-day.other-month {
      background: #f8f9fa;
      color: #adb5bd;
    }
    
    .calendar-day.today {
      background: linear-gradient(135deg, #e8f4fd 0%, #d1ecf1 100%);
      border: 2px solid #152d64;
    }
    
    .calendar-day.today .day-number {
      color: #152d64;
      font-weight: 700;
    }
    
    .day-number {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 4px;
      color: #152d64;
    }
    
    .reservation-indicator {
      width: 100%;
      height: 18px;
      border-radius: 3px;
      margin-bottom: 2px;
      font-size: 10px;
      padding: 1px 4px;
      color: white;
      font-weight: 500;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .reservation-indicator:hover {
      transform: scale(1.02);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .reservation-indicator.pending {
      background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    }
    
    .reservation-indicator.approved {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .reservation-indicator.active {
      background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
    }
    
    .reservation-indicator.completed {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    }
    
    .reservation-indicator.rejected {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }
    
    .reservation-count {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: #152d64;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Reservation Modal Styles */
    .reservation-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(21, 45, 100, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      background: #152d64;
      color: white;
      border-radius: 12px 12px 0 0;
    }
    
    .modal-header h4 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .modal-body {
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .modal-reservation {
      border: 1px solid #e9ecef;
      border-radius: 8px;
      margin-bottom: 15px;
      background: #f8f9fa;
      transition: all 0.2s ease;
    }
    
    .modal-reservation:hover {
      background: white;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
    }
    
    .modal-reservation-header {
      padding: 15px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-reservation-title {
      font-weight: 600;
      color: #152d64;
      margin: 0;
      font-size: 16px;
    }
    
    .modal-reservation-body {
      padding: 15px;
    }
    
    .modal-reservation-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .modal-info-item {
      font-size: 14px;
    }
    
    .modal-info-label {
      font-weight: 600;
      color: #495057;
    }
    
    .modal-info-value {
      color: #152d64;
    }
    
    /* Responsive Calendar Styles */
    @media (max-width: 768px) {
      .calendar-navigation {
        flex-direction: column;
        gap: 15px;
      }
      
      .calendar-month-year {
        font-size: 20px;
        min-width: auto;
      }
      
      .calendar-legend {
        flex-direction: column;
        gap: 10px;
        align-items: center;
      }
      
      .calendar-legend .legend-item {
        justify-content: center;
      }
      
      .calendar-day {
        min-height: 80px;
        padding: 4px;
      }
      
      .day-number {
        font-size: 14px;
      }
      
      .reservation-indicator {
        height: 14px;
        font-size: 9px;
        padding: 1px 2px;
      }
      
      .reservation-count {
        width: 16px;
        height: 16px;
        font-size: 9px;
      }
      
      .modal-content {
        width: 95%;
        margin: 10px;
      }
      
      .modal-reservation-info {
        grid-template-columns: 1fr;
        gap: 5px;
      }
    }
    
    @media (max-width: 480px) {
      .calendar-day {
        min-height: 60px;
        padding: 2px;
      }
      
      .calendar-day-header {
        padding: 8px;
        font-size: 12px;
      }
      
      .day-number {
        font-size: 12px;
      }
      
      .reservation-indicator {
        height: 12px;
        font-size: 8px;
        padding: 1px;
      }
    }
    
    /* Table styles from requests.html */
    .reservations-table {
      width: 100%;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(21, 45, 100, 0.1);
      margin: 20px 0;
    }
    
    .reservations-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .reservations-table th {
      background: #152d64;
      color: white;
      padding: 16px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #0d1f4a;
    }
    
    .reservations-table th:first-child {
      padding-left: 20px;
    }
    
    .reservations-table th:last-child {
      padding-right: 20px;
      text-align: center;
    }
    
    .reservations-table td {
      padding: 16px 12px;
      border-bottom: 1px solid #e9ecef;
      vertical-align: middle;
    }
    
    .reservations-table td:first-child {
      padding-left: 20px;
    }
    
    .reservations-table td:last-child {
      padding-right: 20px;
      text-align: center;
    }
    
    .reservations-table tr {
      transition: background-color 0.2s ease;
    }
    
    .reservations-table tbody tr:hover {
      background-color: #f8f9fa;
    }
    
    .reservations-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    /* Expandable row styles */
    .expandable-row td:not(:last-child) {
      cursor: pointer;
    }
    
    .expandable-row td:last-child {
      cursor: default;
    }
    
    .expand-icon {
      margin-right: 8px;
      transition: transform 0.3s ease;
      color: #152d64;
      font-size: 12px;
    }
    
    .expand-icon.expanded {
      transform: rotate(90deg);
    }
    
    .expandable-row td:not(:last-child):hover .expand-icon {
      color: #0d1f4a;
    }
    
    .expandable-row td:first-child {
      position: relative;
    }
    
    .details-row {
      display: none;
    }
    
    .details-row.show {
      display: table-row;
    }
    
    .details-row td {
      background-color: #f8f9fa;
      padding: 20px;
      border-bottom: 2px solid #e9ecef;
    }
    
    .details-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .details-section h5 {
      color: #152d64;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .details-section p {
      margin: 5px 0;
      font-size: 14px;
      color: #495057;
    }
    
    .details-section strong {
      color: #152d64;
      font-weight: 600;
    }
    
    /* Text utility classes */
    .text-muted {
      color: #6c757d !important;
    }
    
    /* Responsive table design */
    @media (max-width: 1200px) {
      .reservations-table th:nth-child(3),
      .reservations-table td:nth-child(3) {
        display: none;
      }
    }
    
    @media (max-width: 900px) {
      .reservations-table th:nth-child(4),
      .reservations-table td:nth-child(4) {
        display: none;
      }
      
      .reservations-table th:nth-child(6),
      .reservations-table td:nth-child(6) {
        display: none;
      }
    }
    
    @media (max-width: 768px) {
      .reservations-table {
        margin: 15px 0;
        border-radius: 8px;
      }
      
      .reservations-table th,
      .reservations-table td {
        padding: 12px 8px;
        font-size: 14px;
      }
      
      .reservations-table th:first-child,
      .reservations-table td:first-child {
        padding-left: 15px;
      }
      
      .reservations-table th:last-child,
      .reservations-table td:last-child {
        padding-right: 15px;
      }
      
      .details-content {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .reservations-table th:nth-child(2),
      .reservations-table td:nth-child(2) {
        min-width: 120px;
      }
      
      .detail-link {
        padding: 4px 8px;
        font-size: 12px;
      }
      
      .status-badge {
        padding: 4px 8px;
        font-size: 10px;
      }
    }

    /* Pagination Styles */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }

    .pagination {
      display: flex;
      gap: 10px;
      padding: 20px;
      list-style: none;
      margin: 0;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .pagination a,
    .pagination span {
      color: #152d64;
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid #152d64;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .pagination a:hover {
      background-color: #152d64;
      color: white;
    }

    .pagination .current {
      background-color: #152d64;
      color: white;
      border-color: #152d64;
      padding: 8px 16px;
      border: 1px solid #152d64;
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .pagination {
        padding: 15px;
        gap: 8px;
      }

      .pagination a,
      .pagination span {
        padding: 6px 12px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  {% include 'app/navbar.html' %}

  <div class="reservations-container">
    <h1 class="reservations-title">
      <i class="fas fa-calendar-check"></i>
      Reservations
    </h1>

    <!-- Search and Filter Controls -->
    <div class="search-filter-container">
      <form method="get" class="search-filter-form" id="reservationFilterForm">
        <div class="search-row">
          <!-- Search Input -->
          <div class="search-input-group">
            <i class="fas fa-search search-icon"></i>
            <input 
              type="text" 
              name="search" 
              class="search-input"
              placeholder="Search by reserver, item, or purpose..."
              value="{{ request.GET.search }}"
              autocomplete="off"
            >
          </div>
          
          <!-- Department Filter -->
          <div class="filter-group">
            <select name="department" class="filter-select">
              <option value="">All Departments</option>
              {% for dept in departments %}
              <option value="{{ dept.id }}" {% if request.GET.department == dept.id|stringformat:"s" %}selected{% endif %}>
                {{ dept.name }}
              </option>
              {% endfor %}
            </select>
          </div>
          
          <!-- Date Range Filters -->
          <div class="filter-group">
            <input 
              type="date" 
              name="date_from" 
              class="date-input"
              placeholder="From Date"
              value="{{ request.GET.date_from }}"
            >
          </div>
          
          <div class="filter-group">
            <input 
              type="date" 
              name="date_to" 
              class="date-input"
              placeholder="To Date"
              value="{{ request.GET.date_to }}"
            >
          </div>
          
          <!-- Filter Buttons -->
          <div class="filter-buttons">
            <button type="submit" class="btn-filter">
              <i class="fas fa-filter"></i>
              Apply Filters
            </button>
            <a href="{% url 'user_reservations' %}" class="btn-clear">
              <i class="fas fa-times"></i>
              Clear
            </a>
          </div>
        </div>
      </form>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
      <button class="tab-button active" onclick="showTab('all', this)" id="allTab">
        <i class="fas fa-list"></i>
        All Reservations
        <span class="badge">{{ all_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('pending', this)" id="pendingTab">
        <i class="fas fa-clock"></i>
        Pending
        <span class="badge">{{ pending_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('approved', this)" id="approvedTab">
        <i class="fas fa-check-circle"></i>
        Approved
        <span class="badge">{{ approved_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('active', this)" id="activeTab">
        <i class="fas fa-play-circle"></i>
        Active
        <span class="badge">{{ active_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('completed', this)" id="completedTab">
        <i class="fas fa-check-double"></i>
        Completed
        <span class="badge">{{ completed_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('rejected', this)" id="rejectedTab">
        <i class="fas fa-times-circle"></i>
        Rejected
        <span class="badge">{{ rejected_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('expired', this)" id="expiredTab">
        <i class="fas fa-calendar-times"></i>
        Expired
        <span class="badge">{{ expired_count }}</span>
      </button>
      <button class="tab-button" onclick="showTab('calendar', this)" id="calendarTab">
        <i class="fas fa-calendar-alt"></i>
        Calendar View
      </button>
    </div>

    <main class="reservations-content">
      <!-- All Reservations Tab -->
      <div id="all" class="tab-content active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">All Reservations</h3>
        </div>
        {% if all_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in all_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    {% if batch.status == 'pending' %}
                      <i class="fas fa-clock"></i>
                    {% elif batch.status == 'approved' %}
                      <i class="fas fa-check-circle"></i>
                    {% elif batch.status == 'active' %}
                      <i class="fas fa-play-circle"></i>
                    {% elif batch.status == 'completed' %}
                      <i class="fas fa-check-double"></i>
                    {% elif batch.status == 'rejected' %}
                      <i class="fas fa-times-circle"></i>
                    {% elif batch.status == 'expired' %}
                      <i class="fas fa-calendar-times"></i>
                    {% elif batch.status == 'partially_approved' %}
                      <i class="fas fa-check-circle" style="opacity: 0.6;"></i>
                    {% endif %}
                    {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              {% endwith %}
              </tr>
              <tr class="details-row" id="details-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.latest_return_date %}
                        <p><strong>Latest Return Date:</strong> {{ batch.latest_return_date|date:"M d, Y" }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      {% if batch.approved_date %}
                        <p><strong>Approved Date:</strong> {{ batch.approved_date|date:"M d, Y H:i" }}</p>
                      {% endif %}
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Pagination for All -->
        {% if all_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if all_reservations.has_previous %}
              <a href="?all_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?all_page={{ all_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ all_reservations.number }} of {{ all_reservations.paginator.num_pages }}
            </span>

            {% if all_reservations.has_next %}
              <a href="?all_page={{ all_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?all_page={{ all_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-calendar-times"></i>
          <p>No reservations found matching your criteria.</p>
        </div>
        {% endif %}
      </div>

      <!-- Pending Reservations Tab -->
      <div id="pending" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Pending Reservations</h3>
        </div>
        {% if pending_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in pending_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-pending-{{ batch.id }}"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> {{ batch.total_items }} items</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-clock"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              </tr>
              <tr class="details-row" id="details-pending-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                    </div>
                  </div>
                </td>
              </tr>
              {% endwith %}
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Pending -->
        {% if pending_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if pending_reservations.has_previous %}
              <a href="?pending_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?pending_page={{ pending_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ pending_reservations.number }} of {{ pending_reservations.paginator.num_pages }}
            </span>

            {% if pending_reservations.has_next %}
              <a href="?pending_page={{ pending_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?pending_page={{ pending_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-clock"></i>
          <p>No pending reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Approved Reservations Tab -->
      <div id="approved" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Approved Reservations</h3>
        </div>
        {% if approved_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Batch ID</th>
                <th>Reserver</th>
                <th>Items</th>
                <th>Total Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in approved_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-approved-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-check-circle"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              </tr>
              <tr class="details-row" id="details-approved-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.latest_return_date %}
                        <p><strong>Latest Return Date:</strong> {{ batch.latest_return_date|date:"M d, Y" }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      {% if batch.approved_date %}
                        <p><strong>Approved Date:</strong> {{ batch.approved_date|date:"M d, Y H:i" }}</p>
                      {% endif %}
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                  </div>
                </td>
              </tr>
              {% endwith %}
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Approved -->
        {% if approved_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if approved_reservations.has_previous %}
              <a href="?approved_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?approved_page={{ approved_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ approved_reservations.number }} of {{ approved_reservations.paginator.num_pages }}
            </span>

            {% if approved_reservations.has_next %}
              <a href="?approved_page={{ approved_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?approved_page={{ approved_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-check-circle"></i>
          <p>No approved reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Active Reservations Tab -->
      <div id="active" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Active Reservations</h3>
        </div>
        {% if active_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in active_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-active-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-play-circle"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              {% endwith %}
              </tr>
              <tr class="details-row" id="details-active-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.latest_return_date %}
                        <p><strong>Latest Return Date:</strong> {{ batch.latest_return_date|date:"M d, Y" }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      {% if batch.approved_date %}
                        <p><strong>Approved Date:</strong> {{ batch.approved_date|date:"M d, Y H:i" }}</p>
                      {% endif %}
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Active -->
        {% if active_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if active_reservations.has_previous %}
              <a href="?active_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?active_page={{ active_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ active_reservations.number }} of {{ active_reservations.paginator.num_pages }}
            </span>

            {% if active_reservations.has_next %}
              <a href="?active_page={{ active_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?active_page={{ active_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-play-circle"></i>
          <p>No active reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Completed Reservations Tab -->
      <div id="completed" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Completed Reservations</h3>
        </div>
        {% if completed_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in completed_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-completed-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-check-double"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              {% endwith %}
              </tr>
              <tr class="details-row" id="details-completed-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.latest_return_date %}
                        <p><strong>Latest Return Date:</strong> {{ batch.latest_return_date|date:"M d, Y" }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      {% if batch.approved_date %}
                        <p><strong>Approved Date:</strong> {{ batch.approved_date|date:"M d, Y H:i" }}</p>
                      {% endif %}
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Completed -->
        {% if completed_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if completed_reservations.has_previous %}
              <a href="?completed_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?completed_page={{ completed_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ completed_reservations.number }} of {{ completed_reservations.paginator.num_pages }}
            </span>

            {% if completed_reservations.has_next %}
              <a href="?completed_page={{ completed_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?completed_page={{ completed_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-check-double"></i>
          <p>No completed reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Rejected Reservations Tab -->
      <div id="rejected" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Rejected Reservations</h3>
        </div>
        {% if rejected_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Needed Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in rejected_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-rejected-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-times-circle"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.earliest_needed_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              </tr>
              <tr class="details-row" id="details-rejected-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                    </div>
                  </div>
                </td>
              </tr>
              {% endwith %}
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Rejected -->
        {% if rejected_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if rejected_reservations.has_previous %}
              <a href="?rejected_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?rejected_page={{ rejected_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ rejected_reservations.number }} of {{ rejected_reservations.paginator.num_pages }}
            </span>

            {% if rejected_reservations.has_next %}
              <a href="?rejected_page={{ rejected_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?rejected_page={{ rejected_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-times-circle"></i>
          <p>No rejected reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Expired Reservations Tab -->
      <div id="expired" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px 0; border-bottom: 1px solid #e9ecef;">
          <h3 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Expired Reservations</h3>
        </div>
        {% if expired_reservations.object_list %}
        <div class="reservations-table">
          <table>
            <thead>
              <tr>
                <th>Reservation ID</th>
                <th>Reserver</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Return Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in expired_reservations.object_list %}
              {% with first_item=batch.items.first %}
              <tr class="expandable-row" data-reservation-id="{{ batch.id }}">
                <td>
                  <i class="fas fa-chevron-right expand-icon" id="icon-{{ batch.id }}"></i>
                  <i class="fas fa-layer-group" title="Batch Reservation" style="color: #152d64; margin-right: 5px;"></i>
                  RES-{{ batch.id|stringformat:"03d" }}
                </td>
                <td>
                  <strong>
                    {% with batch.user.first_name as first_name %}
                    {% with batch.user.last_name as last_name %}
                      {% if first_name or last_name %}
                        {{ first_name }} {{ last_name }}
                      {% else %}
                        {{ batch.user.username }}
                      {% endif %}
                    {% endwith %}
                    {% endwith %}
                  </strong>
                  <br>
                  <small class="text-muted">{{ batch.user.userprofile.department }}</small>
                </td>
                <td>
                  {% if first_item %}
                    {{ first_item.property.property_name }}
                    {% if batch.total_items > 1 %}
                      <br><small style="color: #6c757d;"><i class="fas fa-layer-group"></i> Batch ({{ batch.total_items }} items)</small>
                    {% endif %}
                  {% else %}
                    <em>No items</em>
                  {% endif %}
                </td>
                <td>{{ batch.total_quantity }}</td>
                <td>
                  <span class="status-badge status-{{ batch.status|lower|cut:' ' }}">
                    <i class="fas fa-calendar-times"></i> {{ batch.get_status_display }}
                  </span>
                </td>
                <td>{{ batch.latest_return_date|date:"M d, Y"|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'reservation_batch_detail' batch.id %}" class="detail-link">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                </td>
              {% endwith %}
              </tr>
              <tr class="details-row" id="details-{{ batch.id }}">
                <td colspan="7">
                  <div class="details-content">
                    <div class="details-section">
                      <h5>Batch Reservation Information</h5>
                      <p><strong>Purpose:</strong> {{ batch.purpose }}</p>
                      <p><strong>Request Date:</strong> {{ batch.request_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Total Items:</strong> {{ batch.total_items }}</p>
                      <p><strong>Total Quantity:</strong> {{ batch.total_quantity }}</p>
                      {% if batch.earliest_needed_date %}
                        <p><strong>Earliest Needed Date:</strong> {{ batch.earliest_needed_date|date:"M d, Y" }}</p>
                      {% endif %}
                      {% if batch.latest_return_date %}
                        <p><strong>Latest Return Date:</strong> {{ batch.latest_return_date|date:"M d, Y" }}</p>
                      {% endif %}
                    </div>
                    <div class="details-section">
                      <h5>Status Information</h5>
                      <p><strong>Current Status:</strong> {{ batch.get_status_display }}</p>
                      {% if batch.approved_date %}
                        <p><strong>Approved Date:</strong> {{ batch.approved_date|date:"M d, Y H:i" }}</p>
                      {% endif %}
                      <p><strong>Department:</strong> {{ batch.user.userprofile.department }}</p>
                      {% if batch.remarks %}
                        <p><strong>Remarks:</strong> {{ batch.remarks }}</p>
                      {% endif %}
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Pagination for Expired -->
        {% if expired_reservations.has_other_pages %}
        <div class="pagination-container">
          <div class="pagination">
            {% if expired_reservations.has_previous %}
              <a href="?expired_page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">&laquo; First</a>
              <a href="?expired_page={{ expired_reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
              Page {{ expired_reservations.number }} of {{ expired_reservations.paginator.num_pages }}
            </span>

            {% if expired_reservations.has_next %}
              <a href="?expired_page={{ expired_reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Next</a>
              <a href="?expired_page={{ expired_reservations.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}">Last &raquo;</a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-calendar-times"></i>
          <p>No expired reservations found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Calendar View Tab -->
      <div id="calendar" class="tab-content">
        <h3>Reservations Calendar</h3>
        
        <!-- Calendar Navigation -->
        <div class="calendar-navigation">
          <button class="calendar-nav-btn" onclick="previousMonth()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <div class="calendar-month-year">
            <span id="calendar-month-year"></span>
          </div>
          <button class="calendar-nav-btn" onclick="nextMonth()">
            <i class="fas fa-chevron-right"></i>
          </button>
          <button class="calendar-today-btn" onclick="goToToday()">
            <i class="fas fa-calendar-day"></i>
            Today
          </button>
        </div>

        <!-- Calendar Legend -->
        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-color status-pending"></div>
            <span>Pending</span>
          </div>
          <div class="legend-item">
            <div class="legend-color status-approved"></div>
            <span>Approved</span>
          </div>
          <div class="legend-item">
            <div class="legend-color status-active"></div>
            <span>Active</span>
          </div>
          <div class="legend-item">
            <div class="legend-color status-completed"></div>
            <span>Completed</span>
          </div>
          <div class="legend-item">
            <div class="legend-color status-rejected"></div>
            <span>Rejected</span>
          </div>
          <div class="legend-item">
            <div class="legend-color status-expired"></div>
            <span>Expired</span>
          </div>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-container">
          <div class="calendar-header">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
          </div>
          <div class="calendar-body" id="calendar-body">
            <!-- Calendar days will be generated by JavaScript -->
          </div>
        </div>

        <!-- Reservation Details Modal -->
        <div id="reservation-modal" class="reservation-modal" style="display: none;">
          <div class="modal-content">
            <div class="modal-header">
              <h4 id="modal-date-title"></h4>
              <button class="modal-close" onclick="closeReservationModal()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body" id="modal-reservations-list">
              <!-- Reservation details will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Reservation data as JSON -->
  <script id="reservation-data" type="application/json">{{ reservation_data|safe }}</script>
  
  <script>
    // Initialize event listeners when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeEventListeners();
      initializeActiveTab();
      initializeFormHandling();
    });

    function initializeEventListeners() {
      // Event delegation for expandable table rows
      document.addEventListener('click', function(e) {
        // Don't trigger row expansion if clicking on links, buttons, or form elements
        if (e.target.closest('a, button, input, select, textarea, form')) {
          return;
        }
        
        const expandableRow = e.target.closest('.expandable-row');
        if (expandableRow) {
          e.preventDefault();
          const reservationId = expandableRow.dataset.reservationId;
          toggleReservationDetails(reservationId);
        }
      });
    }
    
    function initializeActiveTab() {
      // Check if there's a saved tab preference
      const savedTab = localStorage.getItem('activeReservationTab') || 'all';
      const tabButton = document.getElementById(savedTab + 'Tab');
      if (tabButton) {
        showTab(savedTab, tabButton);
      }
    }
    
    function initializeFormHandling() {
      // Auto-submit form when filter values change
      const filterSelects = document.querySelectorAll('.filter-select, .date-input');
      filterSelects.forEach(select => {
        select.addEventListener('change', function() {
          updateTabAndSubmit();
        });
      });
      
      // Handle search input with debounce
      const searchInput = document.querySelector('.search-input');
      if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function() {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            updateTabAndSubmit();
          }, 500); // 500ms debounce
        });
      }
    }
    
    function updateTabAndSubmit() {
      const activeTab = document.querySelector('.tab-button.active').onclick.toString().match(/'([^']+)'/)[1];
      localStorage.setItem('activeReservationTab', activeTab);
      document.getElementById('reservationFilterForm').submit();
    }

    function showTab(tabName, buttonElement) {
      // Hide all tab contents
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all buttons
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.classList.remove('active');
      });
      
      // Show selected tab content
      const selectedTab = document.getElementById(tabName);
      if (selectedTab) {
        selectedTab.classList.add('active');
      }
      
      // Add active class to clicked button
      buttonElement.classList.add('active');
      
      // Save active tab preference
      localStorage.setItem('activeReservationTab', tabName);
    }

    function toggleReservationDetails(reservationId) {
      // Try different possible ID formats for details row
      const possibleIds = [
        `details-${reservationId}`,
        `details-pending-${reservationId}`,
        `details-approved-${reservationId}`,
        `details-active-${reservationId}`,
        `details-completed-${reservationId}`,
        `details-rejected-${reservationId}`
      ];
      
      let detailsRow = null;
      let expandIcon = null;
      
      // Find the details row and corresponding icon
      for (const id of possibleIds) {
        detailsRow = document.getElementById(id);
        if (detailsRow) {
          // Try to find corresponding icon
          const iconId = id.replace('details-', 'icon-');
          expandIcon = document.getElementById(iconId);
          break;
        }
      }
      
      // If no details row found, try the generic approach
      if (!detailsRow) {
        const possibleIcons = [
          `icon-${reservationId}`,
          `icon-pending-${reservationId}`,
          `icon-approved-${reservationId}`,
          `icon-active-${reservationId}`,
          `icon-completed-${reservationId}`,
          `icon-rejected-${reservationId}`
        ];
        
        for (const iconId of possibleIcons) {
          expandIcon = document.getElementById(iconId);
          if (expandIcon) {
            const detailsId = iconId.replace('icon-', 'details-');
            detailsRow = document.getElementById(detailsId);
            if (detailsRow) break;
          }
        }
      }
      
      if (detailsRow && expandIcon) {
        const isCurrentlyExpanded = detailsRow.classList.contains('show');
        
        // Collapse all other rows first (accordion behavior)
        document.querySelectorAll('.details-row.show').forEach(function(row) {
          row.classList.remove('show');
        });
        document.querySelectorAll('.expand-icon.expanded').forEach(function(icon) {
          icon.classList.remove('expanded');
        });
        
        if (!isCurrentlyExpanded) {
          // Show this row's details
          detailsRow.classList.add('show');
          expandIcon.classList.add('expanded');
        }
      }
    }

    // Calendar functionality
    let currentCalendarDate = new Date();
    let reservationData = [];

    // Get reservation data from Django JSON
    function initializeReservationData() {
      const reservationDataElement = document.getElementById('reservation-data');
      if (reservationDataElement) {
        reservationData = JSON.parse(reservationDataElement.textContent);
      }
    }

    function generateCalendar(year, month) {
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      const calendarBody = document.getElementById('calendar-body');
      const monthYearElement = document.getElementById('calendar-month-year');
      
      // Clear previous calendar
      calendarBody.innerHTML = '';
      
      // Set month and year display
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                         'July', 'August', 'September', 'October', 'November', 'December'];
      monthYearElement.textContent = `${monthNames[month]} ${year}`;

      // Calculate previous month days to show
      const prevMonth = month === 0 ? 11 : month - 1;
      const prevYear = month === 0 ? year - 1 : year;
      const daysInPrevMonth = new Date(prevYear, prevMonth + 1, 0).getDate();

      // Add previous month days
      for (let i = startingDayOfWeek - 1; i >= 0; i--) {
        const dayNumber = daysInPrevMonth - i;
        const dayElement = createCalendarDay(dayNumber, prevYear, prevMonth, true);
        calendarBody.appendChild(dayElement);
      }

      // Add current month days
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = createCalendarDay(day, year, month, false);
        calendarBody.appendChild(dayElement);
      }

      // Add next month days to fill the grid
      const totalCells = calendarBody.children.length;
      const remainingCells = 42 - totalCells; // 6 rows  7 days
      const nextMonth = month === 11 ? 0 : month + 1;
      const nextYear = month === 11 ? year + 1 : year;

      for (let day = 1; day <= remainingCells; day++) {
        const dayElement = createCalendarDay(day, nextYear, nextMonth, true);
        calendarBody.appendChild(dayElement);
      }
    }

    function createCalendarDay(day, year, month, isOtherMonth) {
      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      if (isOtherMonth) dayElement.classList.add('other-month');

      const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      const today = new Date();
      const isToday = dateString === `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
      
      if (isToday && !isOtherMonth) {
        dayElement.classList.add('today');
      }

      // Day number
      const dayNumberElement = document.createElement('div');
      dayNumberElement.className = 'day-number';
      dayNumberElement.textContent = day;
      dayElement.appendChild(dayNumberElement);

      // Get reservations for this date
      const dayReservations = getReservationsForDate(dateString);
      
      // Add reservation indicators
      let indicatorCount = 0;
      const maxIndicators = 3;
      
      dayReservations.forEach((reservation, index) => {
        if (index < maxIndicators) {
          const indicator = document.createElement('div');
          indicator.className = `reservation-indicator ${reservation.status}`;
          indicator.textContent = reservation.itemName;
          indicator.title = `${reservation.itemName} - ${reservation.statusDisplay}`;
          dayElement.appendChild(indicator);
          indicatorCount++;
        }
      });

      // Add count indicator if there are more reservations
      if (dayReservations.length > maxIndicators) {
        const countElement = document.createElement('div');
        countElement.className = 'reservation-count';
        countElement.textContent = `+${dayReservations.length - maxIndicators}`;
        dayElement.appendChild(countElement);
      }

      // Add click handler to show reservations
      if (dayReservations.length > 0) {
        dayElement.addEventListener('click', () => showReservationsModal(dateString, dayReservations));
      }

      return dayElement;
    }

    function getReservationsForDate(dateString) {
      return reservationData.filter(reservation => {
        const neededDate = reservation.neededDate;
        const returnDate = reservation.returnDate;
        return dateString >= neededDate && dateString <= returnDate;
      });
    }

    function showReservationsModal(dateString, reservations) {
      const modal = document.getElementById('reservation-modal');
      const modalTitle = document.getElementById('modal-date-title');
      const modalBody = document.getElementById('modal-reservations-list');

      const formattedDate = new Date(dateString).toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      modalTitle.textContent = `Reservations for ${formattedDate}`;
      modalBody.innerHTML = '';

      reservations.forEach(reservation => {
        const reservationElement = createModalReservationElement(reservation);
        modalBody.appendChild(reservationElement);
      });

      modal.style.display = 'flex';
    }

    function createModalReservationElement(reservation) {
      const element = document.createElement('div');
      element.className = 'modal-reservation';
      
      element.innerHTML = `
        <div class="modal-reservation-header">
          <h5 class="modal-reservation-title">${reservation.itemName}</h5>
          <span class="status-badge status-${reservation.status.toLowerCase().replace(' ', '')}">
            ${reservation.statusDisplay}
          </span>
        </div>
        <div class="modal-reservation-body">
          <div class="modal-reservation-info">
            <div class="modal-info-item">
              <span class="modal-info-label">Reserver:</span>
              <span class="modal-info-value">${reservation.userName}</span>
            </div>
            <div class="modal-info-item">
              <span class="modal-info-label">Department:</span>
              <span class="modal-info-value">${reservation.department}</span>
            </div>
            <div class="modal-info-item">
              <span class="modal-info-label">Quantity:</span>
              <span class="modal-info-value">${reservation.quantity}</span>
            </div>
            <div class="modal-info-item">
              <span class="modal-info-label">Needed Date:</span>
              <span class="modal-info-value">${reservation.neededDate}</span>
            </div>
            <div class="modal-info-item">
              <span class="modal-info-label">Return Date:</span>
              <span class="modal-info-value">${reservation.returnDate}</span>
            </div>
            <div class="modal-info-item">
              <span class="modal-info-label">Purpose:</span>
              <span class="modal-info-value">${reservation.purpose}</span>
            </div>
          </div>
          <div style="margin-top: 10px;">
            <a href="/reservation/${reservation.id}/" class="detail-link">
              <i class="fas fa-external-link-alt"></i> View Details
            </a>
          </div>
        </div>
      `;
      
      return element;
    }

    function closeReservationModal() {
      document.getElementById('reservation-modal').style.display = 'none';
    }

    function previousMonth() {
      if (currentCalendarDate.getMonth() === 0) {
        currentCalendarDate.setFullYear(currentCalendarDate.getFullYear() - 1);
        currentCalendarDate.setMonth(11);
      } else {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
      }
      generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    }

    function nextMonth() {
      if (currentCalendarDate.getMonth() === 11) {
        currentCalendarDate.setFullYear(currentCalendarDate.getFullYear() + 1);
        currentCalendarDate.setMonth(0);
      } else {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
      }
      generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    }

    function goToToday() {
      currentCalendarDate = new Date();
      generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    }

    // Initialize calendar when the calendar tab is shown
    function initializeCalendar() {
      initializeReservationData();
      generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
    }

    // Override showTab function to initialize calendar when needed
    const originalShowTab = showTab;
    showTab = function(tabName, buttonElement) {
      originalShowTab(tabName, buttonElement);
      if (tabName === 'calendar') {
        setTimeout(initializeCalendar, 100); // Small delay to ensure tab is visible
      }
    };

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('reservation-modal');
      if (event.target === modal) {
        closeReservationModal();
      }
    });
  </script>

  <style>
    /* Badge styles */
    .badge {
      background: rgba(255, 255, 255, 0.3);
      color: inherit;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 6px;
    }
    
    .tab-button.active .badge {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    /* Additional responsive adjustments */
    @media (max-width: 768px) {
      .reservation-header h4 {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .reservation-header h4::after {
        display: none;
      }
      
      .status-badge {
        margin-left: 0 !important;
        align-self: flex-start;
      }
    }
  </style>
</body>
</html>
